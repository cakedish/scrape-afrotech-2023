<!DOCTYPE html>
<html>
    <head>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-PJ5WQDMB66"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());        
          gtag('config', 'G-PJ5WQDMB66');
        </script>        
        <title>{{ title }}</title>
        <style>
            #event-details-panel {
                background-color: #fff;
                border: 1px solid #ccc;
                padding: 20px;
                z-index: 1000;
            }
        </style>
        <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.9/index.global.min.js'></script>
        <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/web-component@6.1.9/index.global.min.js'></script>
        <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.9/index.global.min.js'></script>
        <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.9/index.global.min.js'></script>
        <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/list@6.1.9/index.global.min.js'></script>
    
    </head>
    <body>
        <div id="calendar"></div>
        
        <script>
            let calendarEl = document.getElementById('calendar');
            let calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'listWeek',
                initialDate: '2023-11-01',
                // height: 'auto',
                headerToolbar: {
                    "left": "prev,next today",
                    "center": "title",
                    "right": "listWeek,timeGridDay"
                },
                buttonText: {
                    week: 'Agenda',
                    day: 'Day',
                },
                validRange: {
                    start: '2023-10-29',
                    end: '2023-11-12'
                },
                eventClick: function(info) {
                    // Prevent the browser from navigating to the event's url
                    info.jsEvent.preventDefault();
                    
                    // Get the event details
                    var eventTitle = info.event.title;
                    var eventDate = info.event.extendedProps.date;
                    var eventTime = info.event.extendedProps.time;
                    var eventLink = info.event.extendedProps.link;
                    var eventAccess = info.event.extendedProps.access;
                    var eventDescription = info.event.extendedProps.description;
                    var cleanedDescription = eventDescription.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>');
                    

                    // Create the HTML content for the event details
                    var eventDetailsHTML = `
                        <h2>${eventTitle}</h2>
                        <h3>${eventDate} - ${eventTime}</h3>
                        <strong>${eventAccess}</strong><br>
                        <p>${cleanedDescription}</p>                       
                    `;

                    // Add the image only if it exists
                    if (info.event.extendedProps.image !== undefined && info.event.extendedProps.image !== null && info.event.extendedProps.image.trim() !== '') {
                        eventDetailsHTML += `<p><img src="${info.event.extendedProps.image}" style="width: 100%; height: auto; margin-bottom: 20px;" /></p>`;
                    }

                    // Add the link only if it exists
                    if (eventLink !== undefined && eventLink !== null && eventLink.trim() !== '') {
                        eventDetailsHTML += `<p><a href="${eventLink}">Follow this link for more details or to RSVP</a></p>`;
                    }

                    // Update the panel with the event details and show it
                    var eventDetailsPanel = document.getElementById('event-details-panel');
                    eventDetailsPanel.innerHTML = eventDetailsHTML;
                    eventDetailsPanel.style.display = 'block';

                    // You can style the panel with CSS to make it look as desired
                    },
                    events: [
                        {% for event in events %}
                        {
                            id: '{{ event.id }}',
                            title: '{{ event.title }}',
                            start: '{{ event.start }}',
                            end: '{{ event.end }}',
                            access: `{{ event.access }}`,
                            extendedProps: {
                                description: `{{ event.description }}`,
                                date: `{{ event.date }}`,
                                time: `{{ event.time }}`,
                                {% if event.image %}
                                    image: '{{ event.image }}',
                                {% endif %}                                 
                                {% if event.link %}
                                    link: `{{ event.link }}`,
                                {% endif %}                                
                            },
                            {% if "General Admission" in event.access %}
                                backgroundColor: '#4CAF50',
                            {% elif "Students" in event.access %}
                                backgroundColor: 'orange',
                            {% elif "RSVP Required" in event.access %}
                                backgroundColor: '#F44336',
                            {% elif "All Access" in event.access %}
                                backgroundColor: '#FFD700',
                            {% else %}
                                backgroundColor: '#2196F3',
                            {% endif %}
                        },
                        {% endfor %}
                    ],
            });

            calendar.render();
        </script>
        <!-- TODO: filter calendar by access type -->
        <select id="selector">
            <option value="TODO">This feature is not implemented yet</option>
            <option value="all">All</option>
            <option value="1">Marc</option>
            <option value="2">Tom</option>
            <option value="3">David</option>
          </select>
        <div id="event-details-panel" style="display: none;"></div>
    </body>
</html>
